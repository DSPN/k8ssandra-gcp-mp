apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
commonLabels:
  app.kubernetes.io/name: $NAME
  excluded-resource: "no"
  is-crd: "no"

patches:
  - patch: |-
      - op: replace
        path: /spec/template/spec/serviceAccountName
        value: "$NAME-grafanaserviceaccount"
    target:
      kind: Deployment
      name: "$NAME-grafana"
  - patch: |-
      - op: replace
        path: /spec/template/spec/serviceAccountName
        value: "$NAME-cass-operatorserviceaccount"
    target:
      kind: Deployment
      name: "$NAME-cass-operator"
  - patch: |-
      - op: replace
        path: /spec/template/spec/serviceAccountName
        value: "$NAME-kube-promethe-admissionserviceaccount"
    target:
      kind: Job
      name: "$NAME-$KUBE_PROM_NAME-admission-create"
  - patch: |-
      - op: replace
        path: /spec/template/spec/serviceAccountName
        value: "$NAME-kube-promethe-admissionserviceaccount"
    target:
      kind: Job
      name: "$NAME-$KUBE_PROM_NAME-admission-patch"
  - patch: |-
      - op: replace
        path: /spec/template/spec/serviceAccountName
        value: "$NAME-kube-promethe-operatorserviceaccount"
    target:
      kind: Deployment
      name: "$NAME-$KUBE_PROM_NAME-operator"
  - patch: |-
      - op: replace
        path: /spec/serviceAccountName
        value: "$NAME-kube-promethe-prometheusserviceaccount"
    target:
      kind: Prometheus
      name: "$NAME-$KUBE_PROM_NAME-prometheus"

resources:
  - $CHART_FILE_NAME
